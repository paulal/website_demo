{% extends "base.html" %}

{% block app_content %}

<h1>Päivittäisten ravinteiden optimointi</h1>
<p>Määritä tähän haluamasi määrä yhtä ruokalajia, niin algoritmi laskee, mitä sen lisäksi pitää syödä, jotta saa päivittäiset saantisuositukset täytettyä mahdollisin vähin kalorein. Lisää kenttiä useammille ruuille tulee jossain vaiheessa.</p>

<p><strong>Huomautus: Tämä sivu on vielä kesken! Prosessi on myös kovin hidas, malta odottaa... Timeout on 80 sekuntia.</strong></p>

<p>Ruokien ravintosisällöt ovat peräisin Terveyden ja hyvinvoinnin laitoksen Fineli-tietokannan versiosta 20.
Ravinteiden maksimiarvot, siltä osin kuin niille ei ole virallisia suosituksia, ovat valistuneita arvioita.</p>

<p>Tällä hetkellä käytössä ovat keski-ikäisen naisen saantisuositukset. Mahdollisuus valita muu kohderyhmä tulee myöhemmin.</p>
<div class="row">
    <div class="col-md-5">
        <form action="" method="post" novalidate>
            {{ form.hidden_tag() }}
            <p>
                {{ form.food.label }}<br>
                {{ form.food(type="text", id="autocomplete_food", class="form-control") }}
                {% for error in form.food.errors %}
                <span style="color: red;">[{{ error }}]</span>
                {% endfor %}
            </p>
           <p>
                {{ form.amount.label }}<br>
                {{ form.amount(class="form-control") }}</p>
            <p>{{ form.submit() }}</p>
        </form>
        </div>
    </div>
    <br>
{% if data_given %}
    <div>
        Valittu ruoka: {{ data_given[2] }}, {{ data_given[1] }} grammaa<br>
        <br>
        Päivittäinen saantisuositus, valitun ruuan kattama määrä, puuttuva määrä ja päivän maksimi: </br>
        {% for table in tables %}
            {{ table|safe }}
            <br>
        {% endfor %}
    </div>
{% endif %}

{% endblock %}

{% block scripts %}
{{ super() }}
<link href="//code.jquery.com/ui/1.10.2/themes/smoothness/jquery-ui.css" rel="Stylesheet"></link>
<script src="//code.jquery.com/ui/1.10.2/jquery-ui.js" ></script>

<script type="text/javascript">
$(function() {
    $("#autocomplete_food").autocomplete({
        source:function(request, response) {
            $.getJSON("{{url_for('main.autocomplete_food')}}",{
                q: request.term, // in flask, "q" will be the argument to look for using request.args
            }, function(data) {
                response(data.matching_results); // matching_results from jsonify
            });
        },
        minLength: 2,
        select: function(event, ui) {
            console.log(ui.item.value);
        }
    });
})

</script>
{% endblock %}